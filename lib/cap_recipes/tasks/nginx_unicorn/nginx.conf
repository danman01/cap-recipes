worker_processes  1;

error_log  /var/log/nginx/error.log;

events {
    worker_connections  50240;
    use epoll;
}

http {
    include       mime.types;
    types {
      audio/x-wav wav;
    }
    default_type  application/octet-stream;

    ssl_protocols        SSLv3 TLSv1;
    ssl_ciphers          HIGH:!ADH:!MD5;

    server_names_hash_bucket_size 128;

    # The proxy_read_timeout directive sets the read timeout for the response of the proxied server,
    # in seconds by default. It determines how long nginx will wait to get the response to a request.
    # The timeout is established not for entire response, but only between two operations of reading.
    proxy_read_timeout 121s;

    # $proxy_add_x_forwarded_for
    # Contains client request-header "X-Forwarded-For" with separated by comma $remote_addr.
    # If there is no X-Forwarded-For request-header, than $proxy_add_x_forwarded_for is equal to $remote_addr.

    log_format timing '$remote_addr - $remote_user [$time_local] $scheme $request $status '
      'upstream_response_time $upstream_response_time '
      'msec $msec request_time $request_time';

    client_body_temp_path   '/dev/shm';
    server_name_in_redirect on;
    ignore_invalid_headers  on;
    keepalive_timeout       75 20;
    sendfile                on;
    tcp_nodelay             on;
    tcp_nopush              on;

    gzip  on;
    gzip_http_version 1.0;
    gzip_min_length 0;
    gzip_buffers 16 8k;
    gzip_comp_level 6;
    gzip_static on;
    gzip_proxied any;
    gzip_vary on;
    gzip_types text/plain text/javascript text/css application/x-javascript text/xml;

    ##
    # Optimizations: http://www.typemiss.net/blog/kounoike/20060227-75
    client_header_timeout         10m;
    client_body_timeout           10m;
    send_timeout                  10m;

    connection_pool_size          256;
    client_header_buffer_size     12k;
    large_client_header_buffers   4 8k;
    request_pool_size             4k;

    output_buffers                1 32k;
    postpone_output               1460;
    

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;

}
